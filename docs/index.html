<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>PR12-GrupoE-Destravate</title><meta name="description" content="Documentation for PR12-GrupoE-Destravate"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">PR12-GrupoE-Destravate</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>PR12-GrupoE-Destravate</h2></div>
<div class="tsd-panel tsd-typography">
<a href="#práctica-12---destravate-api-nodeexpress" id="práctica-12---destravate-api-nodeexpress" style="color: inherit; text-decoration: none;">
  <h1>Práctica 12 - Destravate: API Node/Express</h1>
</a>
<p><a href="https://coveralls.io/github/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupoe?branch=main"><img src="https://coveralls.io/repos/github/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupoe/badge.svg?branch=main" alt="Coverage Status"></a></p>
<p><a href="https://sonarcloud.io/summary/new_code?id=ULL-ESIT-INF-DSI-2223_ull-esit-inf-dsi-22-23-prct12-destravate-api-grupoe"><img src="https://sonarcloud.io/api/project_badges/measure?project=ULL-ESIT-INF-DSI-2223_ull-esit-inf-dsi-22-23-prct12-destravate-api-grupoe&metric=alert_status" alt="Quality Gate Status"></a></p>
<p><a href="https://github.com/Marcant97/P13-DSI/actions/workflows/node.js.yml"><img src="https://github.com/Marcant97/P13-DSI/actions/workflows/node.js.yml/badge.svg" alt="Tests"></a></p>

<a href="#índice" id="índice" style="color: inherit; text-decoration: none;">
  <h2>Índice</h2>
</a>
<p><a href="#autores">1.Autores</a><br><a href="#introducci%C3%B3n">2.Introducción</a><br><a href="#enunciado-del-proyecto">3.Enunciado del proyecto</a><br><a href="#mongoose">4.Mongoose</a><br><a href="#c%C3%B3digo-fuente">5.Código fuente</a>
<a href="#relaciones-entre-tablas">6.Relaciones entre tablas</a><br><a href="#dificultades">7.Dificultades</a><br><a href="#tests">8.Tests</a><br><a href="#despliegue">9.Despliegue</a><br><a href="#referencias">10.Referencias</a> </p>

<a href="#autores" id="autores" style="color: inherit; text-decoration: none;">
  <h3>Autores</h3>
</a>
<ul>
<li>Eva Martínez Bencomo (<a href="mailto:alu0101396385@ull.edu.es">alu0101396385@ull.edu.es</a>)  </li>
<li>Adrián González Expósito (<a href="mailto:alu0101404813@ull.edu.es">alu0101404813@ull.edu.es</a>)</li>
<li>Marco Antonio Barroso Hormiga (<a href="mailto:alu0101386560@ull.edu.es">alu0101386560@ull.edu.es</a>)</li>
</ul>

<a href="#introducción" id="introducción" style="color: inherit; text-decoration: none;">
  <h3>Introducción</h3>
</a>
<p>En esta práctica, la segunda grupal de la asignatura, se tendrá que implementar un API REST, haciendo uso de Node.js y Express, que permita llevar a cabo operaciones de creación, lectura, modificación y borrado (Create, Read, Update, Delete - CRUD) de un registro de actividades deportivas.  </p>

<a href="#enunciado-del-proyecto" id="enunciado-del-proyecto" style="color: inherit; text-decoration: none;">
  <h3>Enunciado del proyecto</h3>
</a>
<p><em>Track</em><br>En la ruta /tracks del API, se deberá poder crear, leer, actualizar o borrar una ruta (deportiva) a través de los métodos HTTP necesarios Para cada ruta incluida dentro del sistema, se debe almacenar la información siguiente:  </p>
<ul>
<li>ID único de la ruta.  </li>
<li>Nombre de la ruta.  </li>
<li>Geolocalización del inicio (coordenadas).  </li>
<li>Geolocalización del final de la ruta (coordenadas).  </li>
<li>Longitud de la ruta en kilómetros.  </li>
<li>Desnivel medio de la ruta.  </li>
<li>Usuarios que han realizado la ruta (IDs).  </li>
<li>Tipo de actividad: Indicador si la ruta se puede realizar en bicicleta o corriendo.  </li>
<li>Calificación media de la ruta.  </li>
<li>La operación de lectura o consulta podrá llevarse a cabo de dos maneras diferentes: o bien utilizando una query string donde se consulte por el nombre de la ruta deportiva, o bien utilizando el identificador único de la ruta como parámetro. Las operaciones de modificación y borrado de una ruta también se podrán llevar a cabo de ambos modos.</li>
</ul>
<p><em>Usuarios</em><br>En la ruta /users del API, se deberá poder crear, leer, actualizar o borrar un usuario a través de los métodos HTTP necesarios. Dentro del sistema, necesitamos la siguiente información de los usuarios:  </p>
<ul>
<li>ID único del usuario (puede ser un username creado por el usuario en el registro o un valor generado automáticamente por el sistema).  </li>
<li>Nombre del usuario.  </li>
<li>Actividades que realiza: Correr o bicicleta.  </li>
<li>Amigos en la aplicación: Colleción de IDs de usuarios con los que interacciona.  </li>
<li>Grupos de amigos: Diferentes colecciones de IDs de usuarios con los que suele realizar rutas.  </li>
<li>Estadísticas de entrenamiento: Cantidad de km y desnivel total acumulados en la semana, mes y año.  </li>
<li>Rutas favoritas: IDs de las rutas que el usuario ha realizado con mayor frecuencia.  </li>
<li>Retos activos: IDs de los retos que el usuario está realizando actualmente.  </li>
<li>Histórico de rutas: Los usuarios deben almacenar el historial de rutas realizadas desde que se registraron en el sistema. La información almacenada en esta estructura de datos deberá contener la información de la fecha y el ID de la ruta realizada. Nótese que un usuario puede realizar más de una ruta al día y está decisión puede afectar al tipo de estructura en el que se almacena la información.</li>
</ul>
<p>La operación de lectura o consulta podrá llevarse a cabo de dos maneras diferentes: o bien utilizando una query string donde se consulte por el nombre del usuario, o bien utilizando el identificador único del usuario como parámetro. Las operaciones de modificación y borrado de un usuario también se podrán llevar a cabo de ambos modos.  </p>
<p><em>Grupos</em><br>En la ruta /groups del API, se deberá poder crear, leer, actualizar o borrar una grupo a través de los métodos HTTP necesarios. Un grupo de usuarios engloba la información de los usuarios que se unen para realizar rutas juntos.  </p>
<ul>
<li>ID único del grupo.  </li>
<li>Nombre del grupo.  </li>
<li>Participantes: IDs de los miembros del grupo.  </li>
<li>Estadísticas de entrenamiento grupal: Cantidad de km y desnivel total acumulados de manera grupal en la semana, mes y año.  </li>
<li>Clasificación de los usuarios: Ranking de los usuarios que más entrenamientos han realizado históricamente dentro del grupo, es decir, ordenar los usuarios por la cantidad de km totales o desnivel total que han acumulado.  </li>
<li>Rutas favoritas del grupo: Rutas que los usuarios del grupo han realizado con mayor frecuencia en sus salidas conjuntas.  </li>
<li>Histórico de rutas realizadas por el grupo: Información similar que almacenan los usuarios pero en este caso referente a los grupos Nótese que un usuario puede realizar rutas con un grupo y/o de manera individual el mismo día. Es decir, a modo de simplificación, asumimos que todos los usuarios de un grupo realizan la actividad cuando se planifica. Aunque, también pueden realizar otras actividades de manera individual.<br>La operación de lectura o consulta podrá llevarse a cabo de dos maneras diferentes: o bien utilizando una query string donde se consulte por el nombre del grupo, o bien utilizando el identificador único del grupo como parámetro. Las operaciones de modificación y borrado de una grupo también se podrán llevar a cabo de ambos modos.</li>
</ul>

<a href="#mongoose" id="mongoose" style="color: inherit; text-decoration: none;">
  <h3>Mongoose</h3>
</a>
<p>En lugar de usar el módulo MongoDB hicimos uso de Mongoose, que es un ODM (Object Data Modeling) para MongoDB y Node.js. Es decir, nos permite validar y preparar nuestros datos antes de que pasen a ser almacenados a la base de datos creada</p>

<a href="#código-fuente" id="código-fuente" style="color: inherit; text-decoration: none;">
  <h3>Código fuente</h3>
</a>
<p>El código fuente del proyecto se encuentra alojado en el directorio <em>src</em>. Dentro del mismo encontramos 3 subdirectorios:  </p>
<ol>
<li><em>models</em>: Contiene 4 ficheros, uno por cada modelo de la aplicación (track, user, grupos, retos). En cada uno se encuentra una interfaz, un schema y un modelo.</li>
<li><em>routers</em>: En primer lugar, nos encontramos con el fichero <em>app.ts</em>, donde se encuentra la parte relacionada con el servidor express y se gestionan las peticiones a nivel general, además de manejar las peticiones incorrectas, como cuando no se especifica una ruta. Cuando se usa una ruta, se hace uso de &quot;server.use&quot; y se salta al fichero correspondiente.</li>
</ol>
<pre><code class="language-ts"><span class="hl-0">  </span><span class="hl-1">import</span><span class="hl-0"> </span><span class="hl-2">express</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;express&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-1">import</span><span class="hl-0"> </span><span class="hl-3">&#39;../db/mongoose.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">trackRouter</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;./track.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">userRouter</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;./user.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">retoRouter</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;./retos.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">grupoRouter</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;./grupo.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><br/><span class="hl-0">  </span><span class="hl-1">export</span><span class="hl-0"> </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">server</span><span class="hl-0"> = </span><span class="hl-6">express</span><span class="hl-0">();</span><br/><span class="hl-0">  </span><span class="hl-2">server</span><span class="hl-0">.</span><span class="hl-6">use</span><span class="hl-0">(</span><span class="hl-2">express</span><span class="hl-0">.</span><span class="hl-6">json</span><span class="hl-0">()); </span><span class="hl-7">// para que nos funcione el body</span><br/><br/><span class="hl-0">  </span><span class="hl-2">server</span><span class="hl-0">.</span><span class="hl-6">use</span><span class="hl-0">(</span><span class="hl-3">&#39;/tracks&#39;</span><span class="hl-0">,</span><span class="hl-2">trackRouter</span><span class="hl-0">)</span><br/><span class="hl-0">  </span><span class="hl-2">server</span><span class="hl-0">.</span><span class="hl-6">use</span><span class="hl-0">(</span><span class="hl-3">&#39;/users&#39;</span><span class="hl-0">,</span><span class="hl-2">userRouter</span><span class="hl-0">)</span><br/><span class="hl-0">  </span><span class="hl-2">server</span><span class="hl-0">.</span><span class="hl-6">use</span><span class="hl-0">(</span><span class="hl-3">&#39;/challenges&#39;</span><span class="hl-0">,</span><span class="hl-2">retoRouter</span><span class="hl-0">)</span><br/><span class="hl-0">  </span><span class="hl-2">server</span><span class="hl-0">.</span><span class="hl-6">use</span><span class="hl-0">(</span><span class="hl-3">&#39;/groups&#39;</span><span class="hl-0">,</span><span class="hl-2">grupoRouter</span><span class="hl-0">)</span><br/><br/><span class="hl-0">  </span><span class="hl-2">server</span><span class="hl-0">.</span><span class="hl-6">post</span><span class="hl-0">(</span><span class="hl-3">&#39;*&#39;</span><span class="hl-0">, (</span><span class="hl-2">_</span><span class="hl-0">, </span><span class="hl-2">res</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-6">status</span><span class="hl-0">(</span><span class="hl-8">404</span><span class="hl-0">).</span><span class="hl-6">send</span><span class="hl-0">(</span><span class="hl-3">&#39;404 Not Found&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-2">server</span><span class="hl-0">.</span><span class="hl-6">delete</span><span class="hl-0">(</span><span class="hl-3">&#39;*&#39;</span><span class="hl-0">, (</span><span class="hl-2">_</span><span class="hl-0">, </span><span class="hl-2">res</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-6">status</span><span class="hl-0">(</span><span class="hl-8">404</span><span class="hl-0">).</span><span class="hl-6">send</span><span class="hl-0">(</span><span class="hl-3">&#39;404 Not Found&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-2">server</span><span class="hl-0">.</span><span class="hl-6">get</span><span class="hl-0">(</span><span class="hl-3">&#39;*&#39;</span><span class="hl-0">, (</span><span class="hl-2">_</span><span class="hl-0">, </span><span class="hl-2">res</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-6">status</span><span class="hl-0">(</span><span class="hl-8">404</span><span class="hl-0">).</span><span class="hl-6">send</span><span class="hl-0">(</span><span class="hl-3">&#39;404 Not Found&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-2">server</span><span class="hl-0">.</span><span class="hl-6">patch</span><span class="hl-0">(</span><span class="hl-3">&#39;*&#39;</span><span class="hl-0">, (</span><span class="hl-2">_</span><span class="hl-0">, </span><span class="hl-2">res</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-6">status</span><span class="hl-0">(</span><span class="hl-8">404</span><span class="hl-0">).</span><span class="hl-6">send</span><span class="hl-0">(</span><span class="hl-3">&#39;404 Not Found&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-2">server</span><span class="hl-0">.</span><span class="hl-6">listen</span><span class="hl-0">(</span><span class="hl-8">3000</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-6">log</span><span class="hl-0">(</span><span class="hl-3">&#39;Server running on port 3000&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span>
</code></pre>
<p>A continuación, tenemos un fichero por cada modelo, donde se gestionan las peticiones relacionadas con el mismo. Las diferentes peticiones realizadas son: post, delete, update y get. A modo de ejemplo, comentaremos brevemente el post de user.</p>
<pre><code class="language-ts"><span class="hl-0">  </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">User</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../models/user.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">Reto</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../models/retos.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">Grupo</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../models/grupos.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">Track</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../models/track.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-1">import</span><span class="hl-0"> </span><span class="hl-2">express</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;express&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-0">  </span><span class="hl-1">export</span><span class="hl-0"> </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">userRouter</span><span class="hl-0"> = </span><span class="hl-2">express</span><span class="hl-0">.</span><span class="hl-6">Router</span><span class="hl-0">();</span><br/><br/><span class="hl-0">  </span><span class="hl-7">//*Añadir un usuario</span><br/><span class="hl-0">  </span><span class="hl-2">userRouter</span><span class="hl-0">.</span><span class="hl-6">post</span><span class="hl-0">(</span><span class="hl-3">&#39;/&#39;</span><span class="hl-0">, </span><span class="hl-4">async</span><span class="hl-0"> (</span><span class="hl-2">req</span><span class="hl-0">, </span><span class="hl-2">res</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">newUser</span><span class="hl-0"> = </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-6">User</span><span class="hl-0">(</span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-1">try</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-1">if</span><span class="hl-0"> (</span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">amigos</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-1">while</span><span class="hl-0"> (</span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">amigos</span><span class="hl-0">.</span><span class="hl-2">length</span><span class="hl-0">) {</span><br/><span class="hl-0">          </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">amigo</span><span class="hl-0"> = </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">amigos</span><span class="hl-0">.</span><span class="hl-6">shift</span><span class="hl-0">();</span><br/><span class="hl-0">          </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">user</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-2">User</span><span class="hl-0">.</span><span class="hl-6">findById</span><span class="hl-0">(</span><span class="hl-2">amigo</span><span class="hl-0">);</span><br/><span class="hl-0">          </span><span class="hl-1">if</span><span class="hl-0"> (!</span><span class="hl-2">user</span><span class="hl-0">) {</span><br/><span class="hl-0">            </span><span class="hl-1">return</span><span class="hl-0"> </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-6">status</span><span class="hl-0">(</span><span class="hl-8">400</span><span class="hl-0">).</span><span class="hl-6">send</span><span class="hl-0">({</span><span class="hl-2">error:</span><span class="hl-0"> </span><span class="hl-3">&quot;Alguno de los amigos no existe&quot;</span><span class="hl-0">});</span><br/><span class="hl-0">          }</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">      </span><span class="hl-1">if</span><span class="hl-0"> (</span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">grupos</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-1">while</span><span class="hl-0">(</span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">grupos</span><span class="hl-0">.</span><span class="hl-2">length</span><span class="hl-0">) {</span><br/><span class="hl-0">          </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">grupo</span><span class="hl-0"> = </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">grupos</span><span class="hl-0">.</span><span class="hl-6">shift</span><span class="hl-0">();</span><br/><span class="hl-0">          </span><span class="hl-1">while</span><span class="hl-0">(</span><span class="hl-2">grupo</span><span class="hl-0">.</span><span class="hl-2">miembros</span><span class="hl-0">.</span><span class="hl-2">length</span><span class="hl-0">) {</span><br/><span class="hl-0">            </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">miembro</span><span class="hl-0"> = </span><span class="hl-2">grupo</span><span class="hl-0">.</span><span class="hl-2">miembros</span><span class="hl-0">.</span><span class="hl-6">shift</span><span class="hl-0">();</span><br/><span class="hl-0">            </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">user</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-2">User</span><span class="hl-0">.</span><span class="hl-6">findById</span><span class="hl-0">(</span><span class="hl-2">miembro</span><span class="hl-0">);</span><br/><span class="hl-0">            </span><span class="hl-1">if</span><span class="hl-0"> (!</span><span class="hl-2">user</span><span class="hl-0">) {</span><br/><span class="hl-0">              </span><span class="hl-1">return</span><span class="hl-0"> </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-6">status</span><span class="hl-0">(</span><span class="hl-8">400</span><span class="hl-0">).</span><span class="hl-6">send</span><span class="hl-0">({</span><span class="hl-2">error:</span><span class="hl-0"> </span><span class="hl-3">&quot;Alguno de los miembros del grupo no existe&quot;</span><span class="hl-0">});</span><br/><span class="hl-0">            }</span><br/><span class="hl-0">          }</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">      </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-2">newUser</span><span class="hl-0">.</span><span class="hl-6">save</span><span class="hl-0">();</span><br/><span class="hl-0">      </span><span class="hl-1">return</span><span class="hl-0"> </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-6">status</span><span class="hl-0">(</span><span class="hl-8">201</span><span class="hl-0">).</span><span class="hl-6">send</span><span class="hl-0">(</span><span class="hl-2">newUser</span><span class="hl-0">);</span><br/><span class="hl-0">    } </span><span class="hl-1">catch</span><span class="hl-0"> (</span><span class="hl-2">error</span><span class="hl-0">) {</span><br/><span class="hl-0">      </span><span class="hl-1">return</span><span class="hl-0"> </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-6">status</span><span class="hl-0">(</span><span class="hl-8">400</span><span class="hl-0">).</span><span class="hl-6">send</span><span class="hl-0">(</span><span class="hl-2">error</span><span class="hl-0">);</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  });</span>
</code></pre>
<p>Ha sido una práctica bastante extensa, para no poner todo el código en el informe, consideramos mejor explicar que se ha desarrollado para las peticiones en cada uno de los ficheros del directorio <em>routers</em>. </p>
<p>Para cada uno de los modelos, se ha desarrollado un fichero con el nombre del modelo en plural, donde se encuentran las diferentes peticiones.</p>
<p>Comenzamos con el post, en el cual se crea un nuevo objeto del modelo correspondiente con los datos que se han recibido en la body de la peticion. En todas se introducen los valores definidos en el schema, menos en grupo que las calificaciones son calculadas a partir de los miembros del grupo.  </p>
<p>El getter, se ha desarrollado de manera que se puede solicitar un elemento mediante el nombre del mismo en la query de la peticiónm, o pasando el id como parámetro. De manera similar sucede en el borrar y el modificar.</p>
<p>Asimismo, mencionar que en el caso de los usuarios y en rutas, se ha sido muy meticuloso en el borrado ya que como son atributos de los schemas de otras tablas se gestiona aqui que si al borrar un elemento que se encuentre en otra tabla, vease el caso de un usuario que se encuentra en la tabla de amigos de otro usuario, se borre de la misma.</p>
<ol start="3">
<li><em>db</em>: Contiene un fichero relacionado con la conexión a la base de datos.</li>
</ol>
<pre><code class="language-ts"><span class="hl-0">  </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">connect</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;mongoose&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-0">  </span><span class="hl-1">try</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-6">connect</span><span class="hl-0">(</span><span class="hl-2">process</span><span class="hl-0">.</span><span class="hl-2">env</span><span class="hl-0">.</span><span class="hl-5">MONGODB_URL</span><span class="hl-0">!);</span><br/><span class="hl-0">    </span><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-6">log</span><span class="hl-0">(</span><span class="hl-3">&#39;Connection to MongoDB server established&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">  } </span><span class="hl-1">catch</span><span class="hl-0"> (</span><span class="hl-2">error</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-6">log</span><span class="hl-0">(</span><span class="hl-2">error</span><span class="hl-0">);</span><br/><span class="hl-0">  }</span>
</code></pre>
<p>Se hace uso de <em>&quot;MONGODB_URL&quot;</em> debido a que se esta haciendo uso de una variable de entorno para diferenciar entre la base de datos de desarrollo y la de producción. Tenemos dichas variables alojadas en un fichero config que se encuentra en el directorio raíz del proyecto.  </p>
<p>A continuación, se muestra el contenido del fichero &quot;dev.env&quot;:</p>
<pre><code><span class="hl-5">PORT</span><span class="hl-0">=</span><span class="hl-8">3000</span><br/><span class="hl-5">MONGODB_URL</span><span class="hl-0">=</span><span class="hl-9">mongodb</span><span class="hl-0">:</span><span class="hl-7">//127.0.0.1:27017/app</span>
</code></pre>

<a href="#relaciones-entre-tablas" id="relaciones-entre-tablas" style="color: inherit; text-decoration: none;">
  <h3>Relaciones entre tablas.</h3>
</a>
<p>Esta parte fue la más complicada de implementar, en concreto está relacionada con los delete de las diferentes tablas de la base de datos. Los conflictos que hemos detectado son:<br><em>Rutas</em>  --&gt; Si se borra una ruta, entonces:  </p>
<ul>
<li>Se debe borrar dicha ruta de los usuarios, en concreto de las rutas favoritas y del histórico de rutas.</li>
<li>Se debe borrar dicha ruta de los grupos, en concreto de las rutas favoritas y del histórico de rutas.</li>
<li>Por último, se debe borrar dicha ruta de los retos, en concreto, cualquiera que contenga dicha ruta.</li>
</ul>
<p><em>Usuarios</em>  --&gt; Si se borra un usuario, entonces:  </p>
<ul>
<li>Se debe borrar dicho usuario de los grupos, en concreto de los participantes.</li>
<li>Se debe borrar dicho usuario de los retos, en concreto del ranking.</li>
<li>Se debe borrar de los amigos del resto de usuarios y de los grupos del resto de usuarios.</li>
<li>Se debe borrar el usuario de los retos en los que estuviese.</li>
</ul>
<p><em>Grupos</em>  --&gt; Si se borra un grupo, entonces:  </p>
<ul>
<li>Se debe borrar dicho grupo de los usuarios, en concreto se deberá actualizar los grupos de los usuarios que pertenecían a dicho grupo.</li>
</ul>

<a href="#dificultades" id="dificultades" style="color: inherit; text-decoration: none;">
  <h3>Dificultades</h3>
</a>
<p>Las mayores dificultades que hemos tenido en el desarrollo de la API han sido en primer lugar, el tema de las relaciones entre tablas, ya que no teníamos muy claro como hacerlo. Ya que eran numerosas relaciones y habia que ser muy meticuloso a la hora de desarrollar el borrado de algún elemento. Nos facilito el hecho de organizar en un papel todas las relaciones y ver que elementos se veían afectados por el borrado de un elemento.</p>
<p>Asimismo hemos tenido dificultades con el tema de los tests, ya que era la primera vez que los hacíamos y no sabíamos muy bien como implementarlos. Hemos hecho uso de la librería &quot;supertest&quot; para realizar los tests de la API.</p>

<a href="#tests" id="tests" style="color: inherit; text-decoration: none;">
  <h3>Tests</h3>
</a>

<a href="#despliegue" id="despliegue" style="color: inherit; text-decoration: none;">
  <h3>Despliegue</h3>
</a>

<a href="#referencias" id="referencias" style="color: inherit; text-decoration: none;">
  <h3>Referencias</h3>
</a>
<ul>
<li><p><a href="https://ull-esit-inf-dsi-2223.github.io/prct12-destravate-api/">Guion de la practica</a></p>
</li>
<li><p><a href="https://ull-esit-inf-dsi-2223.github.io/nodejs-theory/">Apuntes de la asignatura</a></p>
</li>
<li><p><a href="https://expressjs.com/es/">Express</a></p>
</li>
<li><p><a href="https://mongoosejs.com/">Mongoose</a></p>
</li>
<li><p><a href="https://www.mongodb.com/">MongoDB</a></p>
</li>
</ul>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">PR12-<wbr/>Grupo<wbr/>E-<wbr/>Destravate</a>
<ul>
<li class="tsd-kind-module"><a href="modules/models_grupos.html">models/grupos</a></li>
<li class="tsd-kind-module"><a href="modules/models_retos.html">models/retos</a></li>
<li class="tsd-kind-module"><a href="modules/models_track.html">models/track</a></li>
<li class="tsd-kind-module"><a href="modules/models_user.html">models/user</a></li>
<li class="tsd-kind-module"><a href="modules/routers_app.html">routers/app</a></li>
<li class="tsd-kind-module"><a href="modules/routers_grupo.html">routers/grupo</a></li>
<li class="tsd-kind-module"><a href="modules/routers_retos.html">routers/retos</a></li>
<li class="tsd-kind-module"><a href="modules/routers_track.html">routers/track</a></li>
<li class="tsd-kind-module"><a href="modules/routers_user.html">routers/user</a></li></ul></li></ul></div></details></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>